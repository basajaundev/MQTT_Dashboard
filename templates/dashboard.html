{% extends "layout.html" %}

{% block title %}
    Dashboard - Dispositivos IoT
{% endblock %}

{% block content %}
<div class="batch-actions-bar" id="batchActionsBar" style="display: none;">
    <span class="batch-selected-count"><span id="selectedCount">0</span> dispositivo(s) seleccionado(s)</span>
    <div class="batch-actions">
        <button class="btn-secondary" data-action="batch-status" title="Solicitar Estado">ğŸ“Š Estado</button>
        <button class="btn-danger" data-action="batch-reboot" title="Reiniciar">ğŸ”„ Reiniciar</button>
        <button class="btn-primary" data-action="batch-custom" title="Comando Personalizado">ğŸ’¬ Comando</button>
        <button class="btn-icon" data-action="batch-deselect-all" title="Deseleccionar Todo">âœ•</button>
    </div>
</div>

<div class="device-grid-container">
    <div class="device-grid-header">
        <h2>Dispositivos Conectados</h2>
        <div class="device-search-container">
            <input type="text" id="deviceSearch" placeholder="Buscar dispositivos..." class="device-search-input">
            <span id="deviceCount" class="device-count"></span>
        </div>
    </div>
    <div id="deviceGrid" class="device-grid">
        <!-- Las tarjetas de dispositivos se insertarÃ¡n aquÃ­ dinÃ¡micamente -->
        <div class="empty-state">
            <p>ğŸ”Œ ConÃ©ctate a un servidor para ver los dispositivos.</p>
        </div>
    </div>
</div>

<!-- Modal para comando personalizado -->
<div id="batchCommandModal" class="modal">
    <div class="modal-content">
        <span class="close" data-action="close-batch-command-modal">&times;</span>
        <h2>ğŸ’¬ Comando Personalizado</h2>
        <div class="batch-command-preview" id="batchCommandPreview"></div>
        <div class="input-group">
            <label>Payload (JSON)</label>
            <textarea id="batchCommandPayload" placeholder='{"cmd": "custom", "value": "..."}'></textarea>
        </div>
        <button class="btn-primary" data-action="execute-batch-command">Enviar a todos</button>
    </div>
</div>

<!-- Modal para el grÃ¡fico de historial -->
<div id="historyModal" class="modal">
    <div class="modal-content modal-lg">
        <span class="close" data-action="close-history-modal">&times;</span>
        <h2 id="historyModalTitle">ğŸ“ˆ Historial del Dispositivo</h2>
        <div class="chart-controls-row">
            <select id="historyDatePreset" class="preset-select">
                <option value="">Seleccionar...</option>
                <option value="today">Hoy</option>
                <option value="yesterday">Ayer</option>
                <option value="week" selected>Semana</option>
                <option value="month">Mes</option>
                <option value="all">Todo</option>
            </select>
            <div class="date-range-inputs">
                <input type="date" id="historyDateStart" class="date-input">
                <span class="date-separator">a</span>
                <input type="date" id="historyDateEnd" class="date-input">
            </div>
            <button class="btn-icon" id="historyChartRefresh" data-action="refresh-history" title="Actualizar">ğŸ”„</button>
        </div>
        <div class="chart-container">
            <canvas id="historyChart"></canvas>
        </div>
        <div class="chart-stats collapsible" id="historyStatsSection">
            <div class="stats-header" data-action="toggle-stats">
                <span>ğŸ“Š EstadÃ­sticas</span>
                <span class="stats-toggle">â–¼</span>
            </div>
            <table class="stats-table" id="historyStatsTable">
                <thead>
                    <tr>
                        <th></th>
                        <th>Min</th>
                        <th>Prom</th>
                        <th>Max</th>
                    </tr>
                </thead>
                <tbody id="historyStatsTableBody"></tbody>
            </table>
        </div>
    </div>
</div>

<!-- Modal para el timeline de eventos -->
<div id="timelineModal" class="modal">
    <div class="modal-content modal-lg">
        <span class="close" data-action="close-timeline-modal">&times;</span>
        <h2>ğŸ“‹ Historial de Eventos</h2>
        <div id="timelineDeviceInfo" class="timeline-device-info"></div>
        <div class="timeline-controls">
            <label for="timelineFilter">Filtrar:</label>
            <select id="timelineFilter">
                <option value="">Todos</option>
                <option value="connected">ğŸŸ¢ Conexiones</option>
                <option value="disconnected">ğŸ”´ Desconexiones</option>
                <option value="offline">âš ï¸ Offline</option>
            </select>
        </div>
        <div class="timeline-container" id="timelineContainer">
            <div class="empty-state">ğŸ“­ No hay eventos registrados</div>
        </div>
    </div>
</div>
{% endblock %}
